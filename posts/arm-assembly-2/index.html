<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>ARM 어셈블리 튜토리얼 (2) 데이터 타입과 레지스터 | 데구루루x2 놀이터</title>
<meta name=keywords content>
<meta name=description content="ARM 어셈블리 기본 내용">
<meta name=author content="deguru22">
<link rel=canonical href=https://deguru22.github.io/posts/arm-assembly-2/>
<link crossorigin=anonymous href=/assets/css/stylesheet.min.5e2b4101351c21e906f398ae96901791830f58d430f96f2659dab7eaef7b3cb7.css integrity="sha256-XitBATUcIekG85iulpAXkYMPWNQw+W8mWdq36u97PLc=" rel="preload stylesheet" as=style>
<link rel=preload href=/images/deguru22.jpg as=image>
<script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://deguru22.github.io/ico/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://deguru22.github.io/ico/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://deguru22.github.io/ico/favicon-32x32.png>
<link rel=apple-touch-icon href=https://deguru22.github.io/ico/apple-touch-icon.png>
<link rel=mask-icon href=https://deguru22.github.io/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.88.1">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-164568875-1','auto'),ga('send','pageview'))</script><meta property="og:title" content="ARM 어셈블리 튜토리얼 (2) 데이터 타입과 레지스터">
<meta property="og:description" content="ARM 어셈블리 기본 내용">
<meta property="og:type" content="article">
<meta property="og:url" content="https://deguru22.github.io/posts/arm-assembly-2/"><meta property="og:image" content="https://deguru22.github.io/static/deguru22.jpg"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-08-22T20:32:12+09:00">
<meta property="article:modified_time" content="2021-08-22T20:32:12+09:00"><meta property="og:site_name" content="데구루루x2 놀이터">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://deguru22.github.io/static/deguru22.jpg">
<meta name=twitter:title content="ARM 어셈블리 튜토리얼 (2) 데이터 타입과 레지스터">
<meta name=twitter:description content="ARM 어셈블리 기본 내용">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://deguru22.github.io/posts/"},{"@type":"ListItem","position":2,"name":"ARM 어셈블리 튜토리얼 (2) 데이터 타입과 레지스터","item":"https://deguru22.github.io/posts/arm-assembly-2/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"ARM 어셈블리 튜토리얼 (2) 데이터 타입과 레지스터","name":"ARM 어셈블리 튜토리얼 (2) 데이터 타입과 레지스터","description":"ARM 어셈블리 기본 내용","keywords":[],"articleBody":"ARM Assembly에 대해 공부하던 중 좋은 글이 있어 번역 하였다.\n출처: Azeria Labs (https://azeria-labs.com/writing-arm-assembly-part-2/)\n 데이터 타입들 하이레벨 언어들과 비슷하게, ARM은 다른 데이터타입에 대한 연산을 지원합니다. 우리가 불러오거나 저장할 수 있는 데이터 타입들은 부호가 없는 워드(unsigned words), 반 워드(half words), 혹은 바이트(bytes) 입니다. 이 데이터 타입들에 대해 붙는 전치사(익스텐션)들은: -h or -sh: halfwords, -b or -sb: bytes이며 워드(words)는 익스텐션이 없습니다. 부호가 있는(signed) 것과 없는(unsigned)것의 차이는 아래와 같습니다.\n 부호가 있는 데이터 타입들은 양수와 음수를 모두 저장할 수 있으므로, 표현할 수 있는 범위(range)가 적습니다. 부호가 없는 데이터 타입은 0을 포함한 큰 양수를 저장할 수 있지만 음수를 저장할 수 없으므로, 표현할 수 있는 범위가 넓습니다.  아래에 데이터 타입들이 실제 명령어로 어떻게 사용되는지 예제를 참고해 주세요.\nldr = Load Word ldr**h** = Load unsigned Half Word ldr**sh** = Load signed Half Word ldr**b** = Load unsigned Byte ldr**sb** = Load signed Bytes str = Store Word str**h** = Store unsigned Half Word str**sh** = Store signed Half Word str**b** = Store unsigned Byte str**sb** = Store signed Byte 엔디안(Endianness) 메모리에서 바이트를 읽는 두 가지 방법이 있습니다: 리틀엔디안(Little-Endian, LE)과 빅엔디안(Big-Endian, BE). 두개의 차이는 메모리에 저장될 때 쓰는 방식입니다(번역자의 코멘트: 한국어와 아랍어의 읽는 방식 차이라고 생각하면 쉽습니다). 리틀 엔디안을 사용하는 인텔 x86 기계들의 경우 가장 낮은 바이트(least-significant-byte)가 낮은 주소에 저장됩니다. ARM 아키텍쳐는 버전 3 이전에는 리틀 엔디안을 사용했지만, 그 이후로는 바이 엔디안(bi-endian)을 사용하는데, 그말인 즉슨 엔디안을 상호 변환할 수 있다는 겁니다. ARMv6의 경우를 예를 들면, 명령어들은 고정된 리틀 엔디안을 사용하고 데이터 접근 시에는 리틀 엔디안 혹은 빅 엔디안을 프로그램 상태 레지스터(Program Status Register, CPSR)의 비트 9, E 비트를 사용해서 읽어올 수 있습니다.\nARM 레지스터 레지스터의 갯수는 ARM 버전에 따라 달라집니다. ARM 레퍼런스 메뉴얼에 따르면, 30개의 일반 목적의 32-bit 레지스터가 있습니다(ARMv6-M과 ARMv7-M 기반의 프로세서는 예외로 합니다). 첫 16개의 레지스터는 사용자 레벨 모드에서 접근 가능하며, 추가 레지스터들은 권한 상승된 소프트웨어 실행 시(ARMv6-M과 ARMv70M 기반의 프로세서 에서는 예외로 합니다) 접근할 수 있습니다. 이 튜토리얼에서는 우리는 권한 상승된 모드에서 접근 가능한 r0-15 레지스터에 대해 배울 것입니다. 이 16개의 레지스터는 2개의 그룹으로 나뉠 수 있습니다: 일반 목적의 레지스터(R0-R11)와 특수 목적의 레지스터(R12-R15).\n   No. 줄임말(별칭) 용도     R0  일반 용도   R1  일반 용도   R2  일반 용도   R3  일반 용도   R4  일반 용도   R5  일반 용도   R6  일반 용도   R7  시스템 명령(Syscall) 숫자 보관용   R8  일반 용도   R9  일반 용도   R10  일반 용도   R11 FP 프레임 포인터(Frame Pointer)     아래는 특수목적 레지스터들   R12 IP 내부 프로시저 콜 (Intra Procedure Call)   R13 SP 스택 포인터   R14 LR 링크 레지스터   R15 PC 프로그램 카운터   CPSR  현재 프로그램 상태 레지스터    아래 표에 인텔 프로세서와 ARM 레지스터를 간단하게 비교해 두었습니다.\n   ARM 설명 x86     R0 일반 용도 EAX   R1-R5 일반 용도 EBX, ECX, EDX, ESI, EDI   R6-R10 일반 용도 -   R11(FP) 프레임 포인터 EBP   R12 내부 프로시저 콜 -   R13(SP) 스택 포인터 ESP   R14(LR) 링크 레지스터 -   R15(PC)  EIP   CPSR 현재 프로그램 상태 레지스터/플래그 EFLAGS    R0-R12: 일반적인 명령 처리 중 임시 값, 포인터(메모리 주소) 등을 저장할 때 사용합니다. 예를 들어 R0는 숫자 연산 작업 중 이전 명령의 결과를 임시로 저장할 때 사용합니다. R7은 syscall(시스템 명령 호출) 번호를 저장하는데 사용하고, R11은 스택의 범위를 추적하여 프레임 포인터로 사용합니다(추후 상세 설명 예정 입니다). 추가적으로, ARM의 함수 호출 컨벤션상 첫 4개의 인자값은 r0-r3 레지스터에 저장하도록 규정하고 있습니다.\nR13: SP(스택 포인터). 스택 포인터는 스택의 가장 높은 곳을 가르킵니다. 스택은 메모리 영역 중 특정 함수의 저장 공간으로 사용되며, 함수 실행이 종료되면 반환됩니다. 그러므로 스택 포인터는 스택 내 공간을 할당하는데 사용하며, 공간 할당 시에는 가지고 있는 포인터에서 할당을 원하는 용량 만큼을 뺍니다. 우리가 32-bit 만큼을 할당하고 싶다면, 스택 포인터에서 4를 빼면 됩니다.\nR14: LR(링크 레지스터). 함수 호출이 이루어 질 때 링크 레지스터는 명령이 실행된 곳에서 다음에 실행할 명령어의 메모리 주소를 가리킵니다. 이렇게 함으로서 호출된 자식 함수로부터 최초 호출한 부모 함수로 되돌아 갔을때 다음에 실행할 명령을 확인할 수 있습니다.\nR15: PC(프로그램 카운터). 프로그램 카운터는 명령이 실행되면 자동으로 특정 크기만큼 증가합니다. ARM 상태에서는 4바이트 증가하고, THUMB 모드에서는 2바이트 증가합니다. 분기 명령이 실행 되었을 경우, PC는 목적지 주소를 저장합니다. 명령 실행 동안에 ARM 상태에서 PC는 현재 명령어 더하기 8 (두개의 ARM 명령어) 의 주소를 저장하고 있고, THUMB(v1) 상태에서는 더하기 4 (두개의 THUMB 명령어) 한 주소값을 저장하고 있습니다. 이 점이 바로 다음 명령어 위치를 가리키는 x86과의 다른점입니다.\n어떻게 PC가 디버거에서 작동하는지 보겠습니다. 아래 프로그램은 PC의 주소를 r0에 저장하고 두 개의 랜덤 명령을 포함하고 있습니다. 어떤일이 일어나는지 확인해 봅시다.\n.section .text .global _start _start: mov r0, pc mov r1, #2 add r2, r1, r1 bkpt GDB에서 우리가 breakpoint를 _start에 걸고 아래와 같이 실행합니다.\ngef br _start Breakpoint 1 at 0x8054 gef run 실행 후 우리가 처음 보는 결과물은 아래와 같습니다.\n$r0 0x00000000 $r1 0x00000000 $r2 0x00000000 $r3 0x00000000 $r4 0x00000000 $r5 0x00000000 $r6 0x00000000 $r7 0x00000000 $r8 0x00000000 $r9 0x00000000 $r10 0x00000000 $r11 0x00000000 $r12 0x00000000 $sp 0xbefff7e0 $lr 0x00000000 **$pc 0x00008054** $cpsr 0x00000010 **0x8054 _start mov r0, pc  $pc** 0x8058 _start+4 mov r0, #2 0x805c _start+8 add r1, r0, r0 0x8060 _start+12 bkpt 0x0000 0x8064 andeq r1, r0, r1, asr #10 0x8068 cmnvs r5, r0, lsl #2 0x806c tsteq r0, r2, ror #18 0x8070 andeq r0, r0, r11 0x8074 tsteq r8, r6, lsl #6 위에서 우리는 PC가 다음에 실행할 명령(mov r0, pc)의 메모리 주소(0x8054)를 가지고 있음을 알고 있습니다. 이제 명령을 실행하면 r0가 PC(0x8054)의 주소를 가지고 있어야 합니다. 맞죠? 아래에서 결과를 확인해 봅시다.\n**$r0 0x0000805c** $r1 0x00000000 $r2 0x00000000 $r3 0x00000000 $r4 0x00000000 $r5 0x00000000 $r6 0x00000000 $r7 0x00000000 $r8 0x00000000 $r9 0x00000000 $r10 0x00000000 $r11 0x00000000 $r12 0x00000000 $sp 0xbefff7e0 $lr 0x00000000 **$pc 0x00008058** $cpsr 0x00000010 **0x8058 _start+4 mov r0, #2  $pc** 0x805c _start+8 add r1, r0, r0 0x8060 _start+12 bkpt 0x0000 0x8064 andeq r1, r0, r1, asr #10 0x8068 cmnvs r5, r0, lsl #2 0x806c tsteq r0, r2, ror #18 0x8070 andeq r0, r0, r11 0x8074 tsteq r8, r6, lsl #6 0x8078 adfcssp f0, f0, #4.0 …맞나요? 아뇨 틀렸습니다. R0에 있는 값을 보세요. 우리는 R0에 전에 미리 읽어놨던 $pc의 값(0x8054) 일것이라고 생각했는데, 우리가 전에 읽었던 실제로는 PC로부터 2 명령어가 지난 값(0x805c)을 저장하고 있습니다. 이 예제를 통해 우리가 직접 PC를 읽을 경우 PC는 바로 다음 명령을 가리킨다는 것을 알 수 있습니다. 그렇지만 디버깅을 해 보면, PC는 현재 PC값에서 다음 두 번째 명령어 위치 (0x8054 + 0x8 = 0x805C)를 가리킨다는 것을 알 수 있습니다. ARM이 이런식으로 만들어져 있는 이유는 이전 세대의 프로세서와의 호환성을 위해서 입니다.\n현재 프로그램 상태 레지스터 (CPSR) gdb를 사용해서 ARM 바이너리를 디버깅 해 보면, 가끔 아래와 같은 플래그(Flags)를 볼 수 있습니다.\n레지스터 $cpsr는 현재 프로그램 상태 레지스터(Current Program Status Register, CPSR) 값을 보여주며, 해당 값을 통해 플래그 - thumb, fast, interrupt, overflow, carry, zero, negative - 를 확인할 수 있습니다. 이 플래그들은 CPSR 레지스터 내의 특정 위치의 비트 값을 통해 활성화 여부를 확인할 수 있습니다. N, Z, C, V 비트들은 x86에서 사용하는 EFLAG 레지스터의 SF, ZF, CF, OF 비트와 동일합니다. 이 비트들은 조건문 혹은 반복문을 어셈블리 레벨에서 서포트 해주는 역할을 합니다. 조건문 코드는 Part 6. 조건문 실행 및 분기 에서 다룰 예정입니다.\n위 사진은 32-bit CPSR 레지스터의 레이아웃을 표시하며, 왼쪽편이 최상위비트(most-significant-bits)이며 오른쪽이 최하위비트(least-significant-bits) 입니다. GE와 M 섹션 및 빈 공간 제외하고 모든 각각의 셀은 1비트 크기를 나타냅니다. 각각의 비트들은 현재 상태를 표현하는데 사용됩니다.\n   플래그 설명     N(Negative) 명령의 결과가 음수일 경우 활성화 됩니다.   Z(Zero) 명령의 결과가 0일경우 활성화 됩니다.   C(Carry) 명령의 결과를 표현하기 위해 33번째 비트가 필요할 경우 활성화 됩니다.   V(Overflow) 명령의 결과를 2의 보수인 32비트로 표현할 수 없을 경우 활성화 됩니다.   E(Endian-bit) ARM은 리틀엔디안이나 빅엔디안을 모두 사용할 수 있습니다. 0을 사용하면 리틀엔디안, 1을 사용하면 빅엔디안 모드입니다.   T(Thumb-bit) THUMB 상태이면 활성화 되며 ARM 상태이면 비활성화 됩니다.   M(Mode-bits) 권한상승모드(USR, SVC 등) 일 때 활성화 됩니다.   J(Jazelle) ARM 프로세서가 하드웨어에서 Java 바이트 코드를 실행하도록 허용할 경우 활성화 됩니다.    만약 우리가 CMP 명령을 통해 1과 2를 비교한다고 생각해 봅시다. 결과는 “마이너스(negative)” 일 것입니다 - 왜냐하면 1 - 2 = -1 이니까요. 우리가 동일한 숫자 두개를 비교할 때, 예를들면 2와 2를 비교한다고 가정해 보면, Z (Zero) 플래그가 설정됩니다. 왜냐하면 2 - 2 = 0 이기 때문이죠. 다만 CMP 명령에 사용되는 레지스터들은 수정할 수 없으며, CSPR이 각각의 레지스터를 비교한 결과를 스스로 수정한다는 사실을 명심하세요.\n이제 GDB에서(GEF가 설치 된 상태에서) 우리가 r1과 r0을 비교했을 때, r1=4이고 r0=2 일 때, 어떻게 보여지는지 확인해 보겠습니다. 실행 결과는 아래와 같습니다:\nCARRY 플래그가 설정된 것을 볼 수 있습니다. 왜냐하면 우리는 cmp r1, r0 명령을 통해 r1=4, r0=2를 비교했고, 4-2=2 이기 때문입니다. 이에 반해, negative 플래그(N)은 설정되지 않았는데 왜냐하면 큰 숫자(4)와 작은 숫자(2)를 비교했기 때문입니다. 만약 우리가 cmp r0, r1 명령을 사용했다면 negative 플래그가 활성화 되었을 것입니다.\n아래에 ARM Infocenter에 명시된 내용을 발췌해 보았습니다:\n N - 명령어 실행 결과가 음수일 때 활성화 Z - 명령어 실행 결과가 0일때 활성화 C - 명령어 실행 결과 캐리(carry)가 생길 경우 활성화 V - 명령어 실행 결과 오버플로우가 생길 경우 활성화  캐리가 생기는 경우는 아래와 같습니다:\n 덧셈을 한 결과값이 2^32 보다 크거나 같을 때 뺄셈을 한 결과값이 양수이거나 0일 때 move나 논리 명령 실행 중 실행된 인라인 배럴 시프터(inline barrel shifter) 명령의 결과  (참고) 인라인 베럴 시프터(inline barrel shifter) 명령이란?\n ARM 산술 논리 장치에는 시프트 및 회전 작업이 가능한 32 비트 배럴 시프터가 있습니다. 여러 ARM 및 Thumb 데이터 처리 및 단일 레지스터 데이터 전송 명령어에 대한 두 번째 피연산자는 데이터 처리 또는 데이터 전송이 명령어의 일부로 실행되기 전에 이동 될 수 있습니다. (참고) 복잡한 명령어들을 처리할 때 사용합니다.  오버플로우는 덧셈, 뺄셈, 비교의 결과값이 2^31 보다 같거나 혹은 크거나, -2^31보다 작을 때 발생합니다.\n","wordCount":"1495","inLanguage":"en","datePublished":"2021-08-22T20:32:12+09:00","dateModified":"2021-08-22T20:32:12+09:00","author":{"@type":"Person","name":"deguru22"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://deguru22.github.io/posts/arm-assembly-2/"},"publisher":{"@type":"Organization","name":"데구루루x2 놀이터","logo":{"@type":"ImageObject","url":"https://deguru22.github.io/ico/favicon.ico"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://deguru22.github.io/ accesskey=h title="Home (Alt + H)">
<img src=/images/deguru22.jpg alt=logo aria-label=logo height=35>Home</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div>
<ul id=menu>
<li>
<a href=https://deguru22.github.io/archives/ title=archives>
<span>archives</span>
</a>
</li>
<li>
<a href=https://deguru22.github.io/tags/ title=tags>
<span>tags</span>
</a>
</li>
<li>
<a href=https://deguru22.github.io/search/ title="search (Alt + /)" accesskey=/>
<span>search</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://deguru22.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://deguru22.github.io/posts/>Posts</a></div>
<h1 class=post-title>
ARM 어셈블리 튜토리얼 (2) 데이터 타입과 레지스터
</h1>
<div class=post-description>
ARM 어셈블리 기본 내용
</div>
<div class=post-meta>August 22, 2021&nbsp;·&nbsp;8 min&nbsp;·&nbsp;deguru22&nbsp;|&nbsp;<a href=https://github.com/deguru22/deguru22.github.io/content/posts/arm-assembly-2.md rel="noopener noreferrer" target=_blank>Suggest Changes</a>
</div>
</header> <div class=toc>
<details open>
<summary accesskey=c title="(Alt + C)">
<span class=details>Table of Contents</span>
</summary>
<div class=inner><ul>
<li>
<a href=#%eb%8d%b0%ec%9d%b4%ed%84%b0-%ed%83%80%ec%9e%85%eb%93%a4 aria-label="데이터 타입들">데이터 타입들</a></li>
<li>
<a href=#%ec%97%94%eb%94%94%ec%95%88endianness aria-label=엔디안(Endianness)>엔디안(Endianness)</a></li>
<li>
<a href=#arm-%eb%a0%88%ec%a7%80%ec%8a%a4%ed%84%b0 aria-label="ARM 레지스터">ARM 레지스터</a></li>
<li>
<a href=#%ed%98%84%ec%9e%ac-%ed%94%84%eb%a1%9c%ea%b7%b8%eb%9e%a8-%ec%83%81%ed%83%9c-%eb%a0%88%ec%a7%80%ec%8a%a4%ed%84%b0-cpsr aria-label="현재 프로그램 상태 레지스터 (CPSR)">현재 프로그램 상태 레지스터 (CPSR)</a>
</li>
</ul>
</div>
</details>
</div>
<div class=post-content><p>ARM Assembly에 대해 공부하던 중 좋은 글이 있어 번역 하였다.</p>
<p>출처: Azeria Labs (<a href=https://azeria-labs.com/writing-arm-assembly-part-2/>https://azeria-labs.com/writing-arm-assembly-part-2/</a>)</p>
<hr>
<h2 id=데이터-타입들>데이터 타입들<a hidden class=anchor aria-hidden=true href=#데이터-타입들>#</a></h2>
<p><img loading=lazy src=https://user-images.githubusercontent.com/42140558/130353591-4c362dca-72c1-49be-b0af-2f79033d5d05.png alt="Data Types">
</p>
<p>하이레벨 언어들과 비슷하게, ARM은 다른 데이터타입에 대한 연산을 지원합니다. 우리가 불러오거나 저장할 수 있는 데이터 타입들은 부호가 없는 워드(unsigned words), 반 워드(half words), 혹은 바이트(bytes) 입니다. 이 데이터 타입들에 대해 붙는 전치사(익스텐션)들은: <code>-h or -sh: halfwords</code>, <code>-b or -sb: bytes</code>이며 워드(words)는 익스텐션이 없습니다. 부호가 있는(signed) 것과 없는(unsigned)것의 차이는 아래와 같습니다.</p>
<ul>
<li>부호가 있는 데이터 타입들은 양수와 음수를 모두 저장할 수 있으므로, 표현할 수 있는 범위(range)가 적습니다.</li>
<li>부호가 없는 데이터 타입은 0을 포함한 큰 양수를 저장할 수 있지만 음수를 저장할 수 없으므로, 표현할 수 있는 범위가 넓습니다.</li>
</ul>
<p>아래에 데이터 타입들이 실제 명령어로 어떻게 사용되는지 예제를 참고해 주세요.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=color:#a6e22e>ldr</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Load</span> <span style=color:#a6e22e>Word</span>
<span style=color:#a6e22e>ldr</span><span style=color:#f92672>**</span><span style=color:#a6e22e>h</span><span style=color:#f92672>**</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Load</span> <span style=color:#a6e22e>unsigned</span> <span style=color:#a6e22e>Half</span> <span style=color:#a6e22e>Word</span>
<span style=color:#a6e22e>ldr</span><span style=color:#f92672>**</span><span style=color:#a6e22e>sh</span><span style=color:#f92672>**</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Load</span> <span style=color:#a6e22e>signed</span> <span style=color:#a6e22e>Half</span> <span style=color:#a6e22e>Word</span>
<span style=color:#a6e22e>ldr</span><span style=color:#f92672>**</span><span style=color:#a6e22e>b</span><span style=color:#f92672>**</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Load</span> <span style=color:#a6e22e>unsigned</span> <span style=color:#a6e22e>Byte</span>
<span style=color:#a6e22e>ldr</span><span style=color:#f92672>**</span><span style=color:#a6e22e>sb</span><span style=color:#f92672>**</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Load</span> <span style=color:#a6e22e>signed</span> <span style=color:#a6e22e>Bytes</span>

<span style=color:#a6e22e>str</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Store</span> <span style=color:#a6e22e>Word</span>
<span style=color:#a6e22e>str</span><span style=color:#f92672>**</span><span style=color:#a6e22e>h</span><span style=color:#f92672>**</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Store</span> <span style=color:#a6e22e>unsigned</span> <span style=color:#a6e22e>Half</span> <span style=color:#a6e22e>Word</span>
<span style=color:#a6e22e>str</span><span style=color:#f92672>**</span><span style=color:#a6e22e>sh</span><span style=color:#f92672>**</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Store</span> <span style=color:#a6e22e>signed</span> <span style=color:#a6e22e>Half</span> <span style=color:#a6e22e>Word</span>
<span style=color:#a6e22e>str</span><span style=color:#f92672>**</span><span style=color:#a6e22e>b</span><span style=color:#f92672>**</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Store</span> <span style=color:#a6e22e>unsigned</span> <span style=color:#a6e22e>Byte</span>
<span style=color:#a6e22e>str</span><span style=color:#f92672>**</span><span style=color:#a6e22e>sb</span><span style=color:#f92672>**</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Store</span> <span style=color:#a6e22e>signed</span> <span style=color:#a6e22e>Byte</span>
</code></pre></div><h2 id=엔디안endianness>엔디안(Endianness)<a hidden class=anchor aria-hidden=true href=#엔디안endianness>#</a></h2>
<p>메모리에서 바이트를 읽는 두 가지 방법이 있습니다: 리틀엔디안(Little-Endian, LE)과 빅엔디안(Big-Endian, BE). 두개의 차이는 메모리에 저장될 때 쓰는 방식입니다(번역자의 코멘트: 한국어와 아랍어의 읽는 방식 차이라고 생각하면 쉽습니다). 리틀 엔디안을 사용하는 인텔 x86 기계들의 경우 가장 낮은 바이트(least-significant-byte)가 낮은 주소에 저장됩니다. ARM 아키텍쳐는 버전 3 이전에는 리틀 엔디안을 사용했지만, 그 이후로는 바이 엔디안(bi-endian)을 사용하는데, 그말인 즉슨 엔디안을 상호 변환할 수 있다는 겁니다. ARMv6의 경우를 예를 들면, 명령어들은 고정된 리틀 엔디안을 사용하고 데이터 접근 시에는 리틀 엔디안 혹은 빅 엔디안을 프로그램 상태 레지스터(Program Status Register, CPSR)의 비트 9, E 비트를 사용해서 읽어올 수 있습니다.</p>
<p><img loading=lazy src=https://user-images.githubusercontent.com/42140558/130353603-3fd3b18e-ba63-4bb5-ac7e-02bf814fdae6.png alt=Endianness>
</p>
<h2 id=arm-레지스터>ARM 레지스터<a hidden class=anchor aria-hidden=true href=#arm-레지스터>#</a></h2>
<p>레지스터의 갯수는 ARM 버전에 따라 달라집니다. ARM 레퍼런스 메뉴얼에 따르면, 30개의 일반 목적의 32-bit 레지스터가 있습니다(ARMv6-M과 ARMv7-M 기반의 프로세서는 예외로 합니다). 첫 16개의 레지스터는 사용자 레벨 모드에서 접근 가능하며, 추가 레지스터들은 권한 상승된 소프트웨어 실행 시(ARMv6-M과 ARMv70M 기반의 프로세서 에서는 예외로 합니다) 접근할 수 있습니다. 이 튜토리얼에서는 우리는 권한 상승된 모드에서 접근 가능한 r0-15 레지스터에 대해 배울 것입니다. 이 16개의 레지스터는 2개의 그룹으로 나뉠 수 있습니다: 일반 목적의 레지스터(R0-R11)와 특수 목적의 레지스터(R12-R15).</p>
<table>
<thead>
<tr>
<th>No.</th>
<th>줄임말(별칭)</th>
<th>용도</th>
</tr>
</thead>
<tbody>
<tr>
<td>R0</td>
<td></td>
<td>일반 용도</td>
</tr>
<tr>
<td>R1</td>
<td></td>
<td>일반 용도</td>
</tr>
<tr>
<td>R2</td>
<td></td>
<td>일반 용도</td>
</tr>
<tr>
<td>R3</td>
<td></td>
<td>일반 용도</td>
</tr>
<tr>
<td>R4</td>
<td></td>
<td>일반 용도</td>
</tr>
<tr>
<td>R5</td>
<td></td>
<td>일반 용도</td>
</tr>
<tr>
<td>R6</td>
<td></td>
<td>일반 용도</td>
</tr>
<tr>
<td>R7</td>
<td></td>
<td>시스템 명령(Syscall) 숫자 보관용</td>
</tr>
<tr>
<td>R8</td>
<td></td>
<td>일반 용도</td>
</tr>
<tr>
<td>R9</td>
<td></td>
<td>일반 용도</td>
</tr>
<tr>
<td>R10</td>
<td></td>
<td>일반 용도</td>
</tr>
<tr>
<td>R11</td>
<td>FP</td>
<td>프레임 포인터(Frame Pointer)</td>
</tr>
<tr>
<td></td>
<td></td>
<td>아래는 특수목적 레지스터들</td>
</tr>
<tr>
<td>R12</td>
<td>IP</td>
<td>내부 프로시저 콜 (Intra Procedure Call)</td>
</tr>
<tr>
<td>R13</td>
<td>SP</td>
<td>스택 포인터</td>
</tr>
<tr>
<td>R14</td>
<td>LR</td>
<td>링크 레지스터</td>
</tr>
<tr>
<td>R15</td>
<td>PC</td>
<td>프로그램 카운터</td>
</tr>
<tr>
<td>CPSR</td>
<td></td>
<td>현재 프로그램 상태 레지스터</td>
</tr>
</tbody>
</table>
<p>아래 표에 인텔 프로세서와 ARM 레지스터를 간단하게 비교해 두었습니다.</p>
<table>
<thead>
<tr>
<th>ARM</th>
<th>설명</th>
<th>x86</th>
</tr>
</thead>
<tbody>
<tr>
<td>R0</td>
<td>일반 용도</td>
<td>EAX</td>
</tr>
<tr>
<td>R1-R5</td>
<td>일반 용도</td>
<td>EBX, ECX, EDX, ESI, EDI</td>
</tr>
<tr>
<td>R6-R10</td>
<td>일반 용도</td>
<td>-</td>
</tr>
<tr>
<td>R11(FP)</td>
<td>프레임 포인터</td>
<td>EBP</td>
</tr>
<tr>
<td>R12</td>
<td>내부 프로시저 콜</td>
<td>-</td>
</tr>
<tr>
<td>R13(SP)</td>
<td>스택 포인터</td>
<td>ESP</td>
</tr>
<tr>
<td>R14(LR)</td>
<td>링크 레지스터</td>
<td>-</td>
</tr>
<tr>
<td>R15(PC)</td>
<td>&lt;- 프로그램 카운터 / 명령 카운터 -></td>
<td>EIP</td>
</tr>
<tr>
<td>CPSR</td>
<td>현재 프로그램 상태 레지스터/플래그</td>
<td>EFLAGS</td>
</tr>
</tbody>
</table>
<p><strong>R0-R12:</strong> 일반적인 명령 처리 중 임시 값, 포인터(메모리 주소) 등을 저장할 때 사용합니다. 예를 들어 R0는 숫자 연산 작업 중 이전 명령의 결과를 임시로 저장할 때 사용합니다. R7은 syscall(시스템 명령 호출) 번호를 저장하는데 사용하고, R11은 스택의 범위를 추적하여 프레임 포인터로 사용합니다(추후 상세 설명 예정 입니다). 추가적으로, ARM의 함수 호출 컨벤션상 첫 4개의 인자값은 r0-r3 레지스터에 저장하도록 규정하고 있습니다.</p>
<p><strong>R13: SP(스택 포인터).</strong> 스택 포인터는 스택의 가장 높은 곳을 가르킵니다. 스택은 메모리 영역 중 특정 함수의 저장 공간으로 사용되며, 함수 실행이 종료되면 반환됩니다. 그러므로 스택 포인터는 스택 내 공간을 할당하는데 사용하며, 공간 할당 시에는 가지고 있는 포인터에서 할당을 원하는 용량 만큼을 뺍니다. 우리가 32-bit 만큼을 할당하고 싶다면, 스택 포인터에서 4를 빼면 됩니다.</p>
<p><strong>R14: LR(링크 레지스터).</strong> 함수 호출이 이루어 질 때 링크 레지스터는 명령이 실행된 곳에서 다음에 실행할 명령어의 메모리 주소를 가리킵니다. 이렇게 함으로서 호출된 자식 함수로부터 최초 호출한 부모 함수로 되돌아 갔을때 다음에 실행할 명령을 확인할 수 있습니다.</p>
<p><strong>R15: PC(프로그램 카운터).</strong> 프로그램 카운터는 명령이 실행되면 자동으로 특정 크기만큼 증가합니다. ARM 상태에서는 4바이트 증가하고, THUMB 모드에서는 2바이트 증가합니다. 분기 명령이 실행 되었을 경우, PC는 목적지 주소를 저장합니다. 명령 실행 동안에 ARM 상태에서 PC는 현재 명령어 더하기 8 (두개의 ARM 명령어) 의 주소를 저장하고 있고, THUMB(v1) 상태에서는 더하기 4 (두개의 THUMB 명령어) 한 주소값을 저장하고 있습니다. 이 점이 바로 다음 명령어 위치를 가리키는 x86과의 다른점입니다.</p>
<p>어떻게 PC가 디버거에서 작동하는지 보겠습니다. 아래 프로그램은 PC의 주소를 r0에 저장하고 두 개의 랜덤 명령을 포함하고 있습니다. 어떤일이 일어나는지 확인해 봅시다.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx>.<span style=color:#a6e22e>section</span> .<span style=color:#a6e22e>text</span>
.<span style=color:#a6e22e>global</span> <span style=color:#a6e22e>_start</span>

<span style=color:#a6e22e>_start</span><span style=color:#f92672>:</span>
  <span style=color:#a6e22e>mov</span> <span style=color:#a6e22e>r0</span>, <span style=color:#a6e22e>pc</span>
  <span style=color:#a6e22e>mov</span> <span style=color:#a6e22e>r1</span>, <span style=color:#960050;background-color:#1e0010>#</span><span style=color:#ae81ff>2</span>
  <span style=color:#a6e22e>add</span> <span style=color:#a6e22e>r2</span>, <span style=color:#a6e22e>r1</span>, <span style=color:#a6e22e>r1</span>
  <span style=color:#a6e22e>bkpt</span>
</code></pre></div><p>GDB에서 우리가 breakpoint를 _start에 걸고 아래와 같이 실행합니다.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=color:#a6e22e>gef</span><span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>br</span> <span style=color:#a6e22e>_start</span>
<span style=color:#a6e22e>Breakpoint</span> <span style=color:#ae81ff>1</span> <span style=color:#a6e22e>at</span> <span style=color:#ae81ff>0x8054</span>
<span style=color:#a6e22e>gef</span><span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>run</span>
</code></pre></div><p>실행 후 우리가 처음 보는 결과물은 아래와 같습니다.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=color:#a6e22e>$r0</span> <span style=color:#ae81ff>0x00000000</span>   <span style=color:#a6e22e>$r1</span> <span style=color:#ae81ff>0x00000000</span>   <span style=color:#a6e22e>$r2</span> <span style=color:#ae81ff>0x00000000</span>   <span style=color:#a6e22e>$r3</span> <span style=color:#ae81ff>0x00000000</span> 
<span style=color:#a6e22e>$r4</span> <span style=color:#ae81ff>0x00000000</span>   <span style=color:#a6e22e>$r5</span> <span style=color:#ae81ff>0x00000000</span>   <span style=color:#a6e22e>$r6</span> <span style=color:#ae81ff>0x00000000</span>   <span style=color:#a6e22e>$r7</span> <span style=color:#ae81ff>0x00000000</span> 
<span style=color:#a6e22e>$r8</span> <span style=color:#ae81ff>0x00000000</span>   <span style=color:#a6e22e>$r9</span> <span style=color:#ae81ff>0x00000000</span>   <span style=color:#a6e22e>$r10</span> <span style=color:#ae81ff>0x00000000</span>  <span style=color:#a6e22e>$r11</span> <span style=color:#ae81ff>0x00000000</span> 
<span style=color:#a6e22e>$r12</span> <span style=color:#ae81ff>0x00000000</span>  <span style=color:#a6e22e>$sp</span> <span style=color:#ae81ff>0xbefff7e0</span>   <span style=color:#a6e22e>$lr</span> <span style=color:#ae81ff>0x00000000</span>   <span style=color:#f92672>**</span><span style=color:#a6e22e>$pc</span> <span style=color:#ae81ff>0x00008054</span><span style=color:#f92672>**</span> 
<span style=color:#a6e22e>$cpsr</span> <span style=color:#ae81ff>0x00000010</span> 

<span style=color:#f92672>**</span><span style=color:#ae81ff>0x8054</span> &lt;<span style=color:#f92672>_start</span>&gt; <span style=color:#a6e22e>mov</span> <span style=color:#a6e22e>r0</span>, <span style=color:#a6e22e>pc</span>     <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>$pc</span><span style=color:#f92672>**</span>
<span style=color:#ae81ff>0x8058</span> &lt;<span style=color:#f92672>_start</span><span style=color:#960050;background-color:#1e0010>+</span><span style=color:#a6e22e>4</span>&gt; <span style=color:#a6e22e>mov</span> <span style=color:#a6e22e>r0</span>, <span style=color:#960050;background-color:#1e0010>#</span><span style=color:#ae81ff>2</span>
<span style=color:#ae81ff>0x805c</span> &lt;<span style=color:#f92672>_start</span><span style=color:#960050;background-color:#1e0010>+</span><span style=color:#a6e22e>8</span>&gt; <span style=color:#a6e22e>add</span> <span style=color:#a6e22e>r1</span>, <span style=color:#a6e22e>r0</span>, <span style=color:#a6e22e>r0</span>
<span style=color:#ae81ff>0x8060</span> &lt;<span style=color:#f92672>_start</span><span style=color:#960050;background-color:#1e0010>+</span><span style=color:#a6e22e>12</span>&gt; <span style=color:#a6e22e>bkpt</span> <span style=color:#ae81ff>0x0000</span>
<span style=color:#ae81ff>0x8064</span> <span style=color:#a6e22e>andeq</span> <span style=color:#a6e22e>r1</span>, <span style=color:#a6e22e>r0</span>, <span style=color:#a6e22e>r1</span>, <span style=color:#a6e22e>asr</span> <span style=color:#960050;background-color:#1e0010>#</span><span style=color:#ae81ff>10</span>
<span style=color:#ae81ff>0x8068</span> <span style=color:#a6e22e>cmnvs</span> <span style=color:#a6e22e>r5</span>, <span style=color:#a6e22e>r0</span>, <span style=color:#a6e22e>lsl</span> <span style=color:#960050;background-color:#1e0010>#</span><span style=color:#ae81ff>2</span>
<span style=color:#ae81ff>0x806c</span> <span style=color:#a6e22e>tsteq</span> <span style=color:#a6e22e>r0</span>, <span style=color:#a6e22e>r2</span>, <span style=color:#a6e22e>ror</span> <span style=color:#960050;background-color:#1e0010>#</span><span style=color:#ae81ff>18</span>
<span style=color:#ae81ff>0x8070</span> <span style=color:#a6e22e>andeq</span> <span style=color:#a6e22e>r0</span>, <span style=color:#a6e22e>r0</span>, <span style=color:#a6e22e>r11</span>
<span style=color:#ae81ff>0x8074</span> <span style=color:#a6e22e>tsteq</span> <span style=color:#a6e22e>r8</span>, <span style=color:#a6e22e>r6</span>, <span style=color:#a6e22e>lsl</span> <span style=color:#960050;background-color:#1e0010>#</span><span style=color:#ae81ff>6</span>
</code></pre></div><p>위에서 우리는 PC가 다음에 실행할 명령(mov r0, pc)의 메모리 주소(0x8054)를 가지고 있음을 알고 있습니다. 이제 명령을 실행하면 r0가 PC(0x8054)의 주소를 가지고 있어야 합니다. 맞죠? 아래에서 결과를 확인해 봅시다.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=color:#f92672>**</span><span style=color:#a6e22e>$r0</span> <span style=color:#ae81ff>0x0000805c</span><span style=color:#f92672>**</span>   <span style=color:#a6e22e>$r1</span> <span style=color:#ae81ff>0x00000000</span>   <span style=color:#a6e22e>$r2</span> <span style=color:#ae81ff>0x00000000</span>   <span style=color:#a6e22e>$r3</span> <span style=color:#ae81ff>0x00000000</span> 
<span style=color:#a6e22e>$r4</span> <span style=color:#ae81ff>0x00000000</span>   <span style=color:#a6e22e>$r5</span> <span style=color:#ae81ff>0x00000000</span>   <span style=color:#a6e22e>$r6</span> <span style=color:#ae81ff>0x00000000</span>   <span style=color:#a6e22e>$r7</span> <span style=color:#ae81ff>0x00000000</span> 
<span style=color:#a6e22e>$r8</span> <span style=color:#ae81ff>0x00000000</span>   <span style=color:#a6e22e>$r9</span> <span style=color:#ae81ff>0x00000000</span>   <span style=color:#a6e22e>$r10</span> <span style=color:#ae81ff>0x00000000</span>  <span style=color:#a6e22e>$r11</span> <span style=color:#ae81ff>0x00000000</span> 
<span style=color:#a6e22e>$r12</span> <span style=color:#ae81ff>0x00000000</span>  <span style=color:#a6e22e>$sp</span> <span style=color:#ae81ff>0xbefff7e0</span>   <span style=color:#a6e22e>$lr</span> <span style=color:#ae81ff>0x00000000</span>   <span style=color:#f92672>**</span><span style=color:#a6e22e>$pc</span> <span style=color:#ae81ff>0x00008058</span><span style=color:#f92672>**</span> 
<span style=color:#a6e22e>$cpsr</span> <span style=color:#ae81ff>0x00000010</span>

<span style=color:#f92672>**</span><span style=color:#ae81ff>0x8058</span> &lt;<span style=color:#f92672>_start</span><span style=color:#960050;background-color:#1e0010>+</span><span style=color:#a6e22e>4</span>&gt; <span style=color:#a6e22e>mov</span> <span style=color:#a6e22e>r0</span>, <span style=color:#960050;background-color:#1e0010>#</span><span style=color:#ae81ff>2</span>       <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>$pc</span><span style=color:#f92672>**</span>
<span style=color:#ae81ff>0x805c</span> &lt;<span style=color:#f92672>_start</span><span style=color:#960050;background-color:#1e0010>+</span><span style=color:#a6e22e>8</span>&gt; <span style=color:#a6e22e>add</span> <span style=color:#a6e22e>r1</span>, <span style=color:#a6e22e>r0</span>, <span style=color:#a6e22e>r0</span>
<span style=color:#ae81ff>0x8060</span> &lt;<span style=color:#f92672>_start</span><span style=color:#960050;background-color:#1e0010>+</span><span style=color:#a6e22e>12</span>&gt; <span style=color:#a6e22e>bkpt</span> <span style=color:#ae81ff>0x0000</span>
<span style=color:#ae81ff>0x8064</span> <span style=color:#a6e22e>andeq</span> <span style=color:#a6e22e>r1</span>, <span style=color:#a6e22e>r0</span>, <span style=color:#a6e22e>r1</span>, <span style=color:#a6e22e>asr</span> <span style=color:#960050;background-color:#1e0010>#</span><span style=color:#ae81ff>10</span>
<span style=color:#ae81ff>0x8068</span> <span style=color:#a6e22e>cmnvs</span> <span style=color:#a6e22e>r5</span>, <span style=color:#a6e22e>r0</span>, <span style=color:#a6e22e>lsl</span> <span style=color:#960050;background-color:#1e0010>#</span><span style=color:#ae81ff>2</span>
<span style=color:#ae81ff>0x806c</span> <span style=color:#a6e22e>tsteq</span> <span style=color:#a6e22e>r0</span>, <span style=color:#a6e22e>r2</span>, <span style=color:#a6e22e>ror</span> <span style=color:#960050;background-color:#1e0010>#</span><span style=color:#ae81ff>18</span>
<span style=color:#ae81ff>0x8070</span> <span style=color:#a6e22e>andeq</span> <span style=color:#a6e22e>r0</span>, <span style=color:#a6e22e>r0</span>, <span style=color:#a6e22e>r11</span>
<span style=color:#ae81ff>0x8074</span> <span style=color:#a6e22e>tsteq</span> <span style=color:#a6e22e>r8</span>, <span style=color:#a6e22e>r6</span>, <span style=color:#a6e22e>lsl</span> <span style=color:#960050;background-color:#1e0010>#</span><span style=color:#ae81ff>6</span>
<span style=color:#ae81ff>0x8078</span> <span style=color:#a6e22e>adfcssp</span> <span style=color:#a6e22e>f0</span>, <span style=color:#a6e22e>f0</span>, <span style=color:#960050;background-color:#1e0010>#</span><span style=color:#ae81ff>4.0</span>
</code></pre></div><p>&mldr;맞나요? 아뇨 틀렸습니다. R0에 있는 값을 보세요. 우리는 R0에 전에 미리 읽어놨던 $pc의 값(0x8054) 일것이라고 생각했는데, 우리가 전에 읽었던 실제로는 PC로부터 2 명령어가 지난 값(0x805c)을 저장하고 있습니다. 이 예제를 통해 우리가 직접 PC를 읽을 경우 PC는 바로 다음 명령을 가리킨다는 것을 알 수 있습니다. 그렇지만 디버깅을 해 보면, PC는 현재 PC값에서 다음 두 번째 명령어 위치 (0x8054 + 0x8 = 0x805C)를 가리킨다는 것을 알 수 있습니다. ARM이 이런식으로 만들어져 있는 이유는 이전 세대의 프로세서와의 호환성을 위해서 입니다.</p>
<h2 id=현재-프로그램-상태-레지스터-cpsr>현재 프로그램 상태 레지스터 (CPSR)<a hidden class=anchor aria-hidden=true href=#현재-프로그램-상태-레지스터-cpsr>#</a></h2>
<p>gdb를 사용해서 ARM 바이너리를 디버깅 해 보면, 가끔 아래와 같은 플래그(Flags)를 볼 수 있습니다.</p>
<p><img loading=lazy src=https://user-images.githubusercontent.com/42140558/130353870-561b0ceb-db7b-46e4-bcfb-7062b812a690.png alt=Flags>
</p>
<p>레지스터 $cpsr는 현재 프로그램 상태 레지스터(Current Program Status Register, CPSR) 값을 보여주며, 해당 값을 통해 플래그 - thumb, fast, interrupt, overflow, carry, zero, negative - 를 확인할 수 있습니다. 이 플래그들은 CPSR 레지스터 내의 특정 위치의 비트 값을 통해 활성화 여부를 확인할 수 있습니다. N, Z, C, V 비트들은 x86에서 사용하는 EFLAG 레지스터의 SF, ZF, CF, OF 비트와 동일합니다. 이 비트들은 조건문 혹은 반복문을 어셈블리 레벨에서 서포트 해주는 역할을 합니다. 조건문 코드는 Part 6. 조건문 실행 및 분기 에서 다룰 예정입니다.</p>
<p><img loading=lazy src=https://user-images.githubusercontent.com/42140558/130353875-ac9422c2-57f4-4efc-ae01-b46cd4360c20.png alt="CPSR 레지스터">
</p>
<p>위 사진은 32-bit CPSR 레지스터의 레이아웃을 표시하며, 왼쪽편이 최상위비트(most-significant-bits)이며 오른쪽이 최하위비트(least-significant-bits) 입니다. GE와 M 섹션 및 빈 공간 제외하고 모든 각각의 셀은 1비트 크기를 나타냅니다. 각각의 비트들은 현재 상태를 표현하는데 사용됩니다.</p>
<table>
<thead>
<tr>
<th>플래그</th>
<th>설명</th>
</tr>
</thead>
<tbody>
<tr>
<td>N(Negative)</td>
<td>명령의 결과가 음수일 경우 활성화 됩니다.</td>
</tr>
<tr>
<td>Z(Zero)</td>
<td>명령의 결과가 0일경우 활성화 됩니다.</td>
</tr>
<tr>
<td>C(Carry)</td>
<td>명령의 결과를 표현하기 위해 33번째 비트가 필요할 경우 활성화 됩니다.</td>
</tr>
<tr>
<td>V(Overflow)</td>
<td>명령의 결과를 2의 보수인 32비트로 표현할 수 없을 경우 활성화 됩니다.</td>
</tr>
<tr>
<td>E(Endian-bit)</td>
<td>ARM은 리틀엔디안이나 빅엔디안을 모두 사용할 수 있습니다. 0을 사용하면 리틀엔디안, 1을 사용하면 빅엔디안 모드입니다.</td>
</tr>
<tr>
<td>T(Thumb-bit)</td>
<td>THUMB 상태이면 활성화 되며 ARM 상태이면 비활성화 됩니다.</td>
</tr>
<tr>
<td>M(Mode-bits)</td>
<td>권한상승모드(USR, SVC 등) 일 때 활성화 됩니다.</td>
</tr>
<tr>
<td>J(Jazelle)</td>
<td>ARM 프로세서가 하드웨어에서 Java 바이트 코드를 실행하도록 허용할 경우 활성화 됩니다.</td>
</tr>
</tbody>
</table>
<p>만약 우리가 CMP 명령을 통해 1과 2를 비교한다고 생각해 봅시다. 결과는 &ldquo;마이너스(negative)&rdquo; 일 것입니다 - 왜냐하면 1 - 2 = -1 이니까요. 우리가 동일한 숫자 두개를 비교할 때, 예를들면 2와 2를 비교한다고 가정해 보면, Z (Zero) 플래그가 설정됩니다. 왜냐하면 2 - 2 = 0 이기 때문이죠. 다만 CMP 명령에 사용되는 레지스터들은 수정할 수 없으며, CSPR이 각각의 레지스터를 비교한 결과를 스스로 수정한다는 사실을 명심하세요.</p>
<p>이제 GDB에서(GEF가 설치 된 상태에서) 우리가 r1과 r0을 비교했을 때, r1=4이고 r0=2 일 때, 어떻게 보여지는지 확인해 보겠습니다. 실행 결과는 아래와 같습니다:</p>
<p><img loading=lazy src=https://user-images.githubusercontent.com/42140558/130353953-2ea514bb-d9c2-404b-94da-d41154548d8a.png alt="실행 결과">
</p>
<p>CARRY 플래그가 설정된 것을 볼 수 있습니다. 왜냐하면 우리는 <code>cmp r1, r0</code> 명령을 통해 r1=4, r0=2를 비교했고, 4-2=2 이기 때문입니다. 이에 반해, negative 플래그(N)은 설정되지 않았는데 왜냐하면 큰 숫자(4)와 작은 숫자(2)를 비교했기 때문입니다. 만약 우리가 <code>cmp r0, r1</code> 명령을 사용했다면 negative 플래그가 활성화 되었을 것입니다.</p>
<p>아래에 <a href=http://infocenter.arm.com/help/topic/com.arm.doc.kui0100a/armasm_chdijedg.htm>ARM Infocenter</a>에 명시된 내용을 발췌해 보았습니다:</p>
<ul>
<li>N - 명령어 실행 결과가 음수일 때 활성화</li>
<li>Z - 명령어 실행 결과가 0일때 활성화</li>
<li>C - 명령어 실행 결과 캐리(carry)가 생길 경우 활성화</li>
<li>V - 명령어 실행 결과 오버플로우가 생길 경우 활성화</li>
</ul>
<p>캐리가 생기는 경우는 아래와 같습니다:</p>
<ul>
<li>덧셈을 한 결과값이 2^32 보다 크거나 같을 때</li>
<li>뺄셈을 한 결과값이 양수이거나 0일 때</li>
<li>move나 논리 명령 실행 중 실행된 인라인 배럴 시프터(inline barrel shifter) 명령의 결과</li>
</ul>
<p>(참고) 인라인 베럴 시프터(inline barrel shifter) 명령이란?</p>
<ul>
<li>ARM 산술 논리 장치에는 시프트 및 회전 작업이 가능한 32 비트 배럴 시프터가 있습니다. 여러 ARM 및 Thumb 데이터 처리 및 단일 레지스터 데이터 전송 명령어에 대한 두 번째 피연산자는 데이터 처리 또는 데이터 전송이 명령어의 일부로 실행되기 전에 이동 될 수 있습니다. <a href=https://www.keil.com/support/man/docs/armasm/armasm_dom1359731140200.htm>(참고)</a></li>
<li>복잡한 명령어들을 처리할 때 사용합니다.</li>
</ul>
<p>오버플로우는 덧셈, 뺄셈, 비교의 결과값이 2^31 보다 같거나 혹은 크거나, -2^31보다 작을 때 발생합니다.</p>
</div>
<footer class=post-footer>
<nav class=paginav>
<a class=prev href=https://deguru22.github.io/posts/arm-assembly-3/>
<span class=title>« Prev Page</span>
<br>
<span>ARM 어셈블리 튜토리얼 (3) ARM & Thumb</span>
</a>
<a class=next href=https://deguru22.github.io/posts/arm-assembly-1/>
<span class=title>Next Page »</span>
<br>
<span>ARM 어셈블리 튜토리얼 (1) 기초</span>
</a>
</nav>
<div class=share-buttons>
<a target=_blank rel="noopener noreferrer" aria-label="share ARM 어셈블리 튜토리얼 (2) 데이터 타입과 레지스터 on twitter" href="https://twitter.com/intent/tweet/?text=ARM%20%ec%96%b4%ec%85%88%eb%b8%94%eb%a6%ac%20%ed%8a%9c%ed%86%a0%eb%a6%ac%ec%96%bc%20%282%29%20%eb%8d%b0%ec%9d%b4%ed%84%b0%20%ed%83%80%ec%9e%85%ea%b3%bc%20%eb%a0%88%ec%a7%80%ec%8a%a4%ed%84%b0&url=https%3a%2f%2fdeguru22.github.io%2fposts%2farm-assembly-2%2f&hashtags="><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share ARM 어셈블리 튜토리얼 (2) 데이터 타입과 레지스터 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fdeguru22.github.io%2fposts%2farm-assembly-2%2f&title=ARM%20%ec%96%b4%ec%85%88%eb%b8%94%eb%a6%ac%20%ed%8a%9c%ed%86%a0%eb%a6%ac%ec%96%bc%20%282%29%20%eb%8d%b0%ec%9d%b4%ed%84%b0%20%ed%83%80%ec%9e%85%ea%b3%bc%20%eb%a0%88%ec%a7%80%ec%8a%a4%ed%84%b0&summary=ARM%20%ec%96%b4%ec%85%88%eb%b8%94%eb%a6%ac%20%ed%8a%9c%ed%86%a0%eb%a6%ac%ec%96%bc%20%282%29%20%eb%8d%b0%ec%9d%b4%ed%84%b0%20%ed%83%80%ec%9e%85%ea%b3%bc%20%eb%a0%88%ec%a7%80%ec%8a%a4%ed%84%b0&source=https%3a%2f%2fdeguru22.github.io%2fposts%2farm-assembly-2%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share ARM 어셈블리 튜토리얼 (2) 데이터 타입과 레지스터 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fdeguru22.github.io%2fposts%2farm-assembly-2%2f&title=ARM%20%ec%96%b4%ec%85%88%eb%b8%94%eb%a6%ac%20%ed%8a%9c%ed%86%a0%eb%a6%ac%ec%96%bc%20%282%29%20%eb%8d%b0%ec%9d%b4%ed%84%b0%20%ed%83%80%ec%9e%85%ea%b3%bc%20%eb%a0%88%ec%a7%80%ec%8a%a4%ed%84%b0"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share ARM 어셈블리 튜토리얼 (2) 데이터 타입과 레지스터 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fdeguru22.github.io%2fposts%2farm-assembly-2%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share ARM 어셈블리 튜토리얼 (2) 데이터 타입과 레지스터 on whatsapp" href="https://api.whatsapp.com/send?text=ARM%20%ec%96%b4%ec%85%88%eb%b8%94%eb%a6%ac%20%ed%8a%9c%ed%86%a0%eb%a6%ac%ec%96%bc%20%282%29%20%eb%8d%b0%ec%9d%b4%ed%84%b0%20%ed%83%80%ec%9e%85%ea%b3%bc%20%eb%a0%88%ec%a7%80%ec%8a%a4%ed%84%b0%20-%20https%3a%2f%2fdeguru22.github.io%2fposts%2farm-assembly-2%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share ARM 어셈블리 튜토리얼 (2) 데이터 타입과 레지스터 on telegram" href="https://telegram.me/share/url?text=ARM%20%ec%96%b4%ec%85%88%eb%b8%94%eb%a6%ac%20%ed%8a%9c%ed%86%a0%eb%a6%ac%ec%96%bc%20%282%29%20%eb%8d%b0%ec%9d%b4%ed%84%b0%20%ed%83%80%ec%9e%85%ea%b3%bc%20%eb%a0%88%ec%a7%80%ec%8a%a4%ed%84%b0&url=https%3a%2f%2fdeguru22.github.io%2fposts%2farm-assembly-2%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg>
</a>
</div>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2021 <a href=https://deguru22.github.io/>데구루루x2 놀이터</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
</body>
</html>